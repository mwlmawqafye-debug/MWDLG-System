{% extends "base.html" %}

{% block title %}إدارة الهوية والمظهر{% endblock %}

{% block content %}

<div class="mb-8">
    <h2 class="text-4xl font-bold text-[var(--color-waqf-green)] font-amiri">إدارة الهوية والمظهر</h2>
    <p class="text-gray-600 mt-2 font-cairo">تحكم في المظهر العام للنظام من هذه الواجهة.</p>
</div>

<div class="bg-white p-8 rounded-xl shadow-md">
    <form id="identity-form">
        <div class="space-y-6">
            <div class="form-group">
                <label for="app-name" class="block text-lg font-cairo font-semibold mb-2">اسم النظام</label>
                <input type="text" id="app-name" name="app-name" placeholder="مثال: نظام الموقوفين" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[var(--color-waqf-green)] focus:border-[var(--color-waqf-green)]">
            </div>

            <div class="form-group">
                <label for="primary-color" class="block text-lg font-cairo font-semibold mb-2">اللون الأساسي</label>
                <div class="flex items-center gap-4">
                    <input type="color" id="primary-color" name="primary-color" value="#1b4d3e" class="p-1 h-12 w-12 block bg-white border border-gray-300 cursor-pointer rounded-lg">
                    <input type="text" id="primary-color-hex" name="primary-color-hex" placeholder="#1b4d3e" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[var(--color-waqf-green)] focus:border-[var(--color-waqf-green)]">
                </div>
            </div>

            <div class="form-group">
                <label for="secondary-color" class="block text-lg font-cairo font-semibold mb-2">اللون الثانوي</label>
                 <div class="flex items-center gap-4">
                    <input type="color" id="secondary-color" name="secondary-color" value="#fdfaf6" class="p-1 h-12 w-12 block bg-white border border-gray-300 cursor-pointer rounded-lg">
                    <input type="text" id="secondary-color-hex" name="secondary-color-hex" placeholder="#fdfaf6" class="w-full p-3 border border-gray-300 rounded-lg focus:ring-[var(--color-waqf-green)] focus:border-[var(--color-waqf-green)]">
                </div>
            </div>
        </div>

        <div class="mt-8 pt-6 border-t border-gray-200 flex items-center justify-between">
            <button type="submit" class="px-8 py-3 text-white bg-[var(--color-waqf-green)] rounded-lg hover:bg-opacity-90 font-semibold">حفظ التغييرات</button>
        </div>
    </form>
    <div id="response-message" class="mt-4"></div>
</div>

<script>
    // JavaScript to sync color picker and hex input
    const setupColorSync = (pickerId, hexInputId) => {
        const picker = document.getElementById(pickerId);
        const hexInput = document.getElementById(hexInputId);
        picker.addEventListener('input', (e) => hexInput.value = e.target.value);
        hexInput.addEventListener('input', (e) => picker.value = e.target.value);
    };
    setupColorSync('primary-color', 'primary-color-hex');
    setupColorSync('secondary-color', 'secondary-color-hex');

    // Form submission logic
    document.getElementById('identity-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const responseMsgDiv = document.getElementById('response-message');
        responseMsgDiv.textContent = '';
        responseMsgDiv.className = '';

        const formData = {
            appName: document.getElementById('app-name').value,
            primaryColor: document.getElementById('primary-color-hex').value,
            secondaryColor: document.getElementById('secondary-color-hex').value
        };

        try {
            const response = await fetch('/api/identity_settings', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(formData)
            });
            const result = await response.json();
            responseMsgDiv.textContent = result.message;
            responseMsgDiv.className = response.ok ? 'p-3 rounded-lg bg-green-100 text-green-800' : 'p-3 rounded-lg bg-red-100 text-red-800';
        } catch (err) {
            responseMsgDiv.textContent = 'حدث خطأ أثناء الاتصال بالخادم.';
            responseMsgDiv.className = 'p-3 rounded-lg bg-red-100 text-red-800';
        }
    });
</script>

{% endblock %}